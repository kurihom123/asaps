<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}ASAPCUT{% endblock %}</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet"/>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.2/css/responsive.dataTables.min.css"/>
</head>
<body class="sb-nav-fixed">
<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <a class="navbar-brand ps-3" href="{% url 'dashboard' %}">ASAPCUT</a>
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>
    <ul class="navbar-nav ms-auto me-3 me-lg-4">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-user fa-fw"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                <li>
                    <a class="dropdown-item" href="#">Profile</a>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <form method="post" action="{% url 'user_logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">Logout</button>
                    </form>
                </li>
            </ul>
        </li>
    </ul>
</nav>

<div id="layoutSidenav">
    <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
            <div class="d-flex flex-column h-100">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{% url 'dashboard' %}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>

                        <!-- STAFF-ONLY MENU ITEMS -->
                        {% if request.user.is_staff %}
                        <div class="sb-sidenav-menu-heading">Management</div>
                        
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                           data-bs-target="#collapseLayoutsUniversities"
                           aria-expanded="false" aria-controls="collapseLayoutsUniversities text-white">
                            <div class="sb-nav-link-icon text-white"><i class="fas fa-university"></i></div>
                            Universities
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseLayoutsUniversities" aria-labelledby="headingOne"
                             data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'university_list' %}">Manage Universities</a>
                            </nav>
                        </div>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                           data-bs-target="#collapseLayoutsAssociations" aria-expanded="false"
                           aria-controls="collapseLayoutsAssociations">
                            <div class="sb-nav-link-icon text-white"><i class="fas fa-users"></i></div>
                            Associations
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseLayoutsAssociations" aria-labelledby="headingOne"
                             data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'association_list' %}">Manage Associations</a>
                            </nav>
                        </div>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                           data-bs-target="#collapseLayoutsContributions" aria-expanded="false"
                           aria-controls="collapseLayoutsContributions">
                            <div class="sb-nav-link-icon text-white"><i class="fas fa-hand-holding-dollar"></i></div>
                            Contributions
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseLayoutsContributions" aria-labelledby="headingOne"
                             data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'contribution_list' %}">Manage Contributions</a>
                            </nav>
                        </div>

                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                           data-bs-target="#collapseLayoutsArrears" aria-expanded="false"
                           aria-controls="collapseLayoutsArrears">
                            <div class="sb-nav-link-icon text-white"><i class="fas fa-exclamation-triangle"></i></div>
                            Arrears
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseLayoutsArrears" aria-labelledby="headingOne"
                             data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'arrears_list' %}">Manage Arrears</a>
                            </nav>
                        </div>

                        <!-- User Management (for specific staff positions) -->
                        {% if request.user.is_authenticated %}
                            {% with user_profile=request.user.user_profile.first %}
                                {% if user_profile and user_profile.position.name in "President General Secretary Treasurer" %}
                                    <a class="nav-link collapsed" href="#" data-bs-toggle="collapse"
                                    data-bs-target="#collapseLayoutsUsers" aria-expanded="false"
                                    aria-controls="collapseLayoutsUsers">
                                        <div class="sb-nav-link-icon text-white"><i class="fas fa-users-cog"></i></div>
                                        Users
                                        <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                    </a>

                                    <div class="collapse" id="collapseLayoutsUsers" aria-labelledby="headingOne"
                                        data-bs-parent="#sidenavAccordion">
                                        <nav class="sb-sidenav-menu-nested nav">
                                            <a class="nav-link" href="{% url 'users_list' %}">
                                                <i class="fas fa-users-cog me-2"></i> Manage Users
                                            </a>
                                        </nav>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        {% endif %}

                        <!-- NORMAL USER MENU ITEMS -->
                        {% else %}
                        <div class="sb-sidenav-menu-heading">My Association</div>
                        
                        <!-- My Contributions -->
                        <a class="nav-link" href="{% url 'my_association_contributions' %}">
                            <div class="sb-nav-link-icon"><i class="fas fa-hand-holding-dollar"></i></div>
                            My Contributions
                        </a>

                        <!-- My Arrears -->
                        <a class="nav-link" href="{% url 'my_association_arrears' %}">
                            <div class="sb-nav-link-icon"><i class="fas fa-exclamation-triangle"></i></div>
                            My Arrears
                        </a>
                        {% endif %}

                    </div>
                </div>

                <div class="sb-sidenav-footer mt-auto">
                    <div class="small">Logged in as:</div>
                    {{ request.user.username }}
                    {% if request.user.is_staff %}
                    <div class="small text-success">(Staff User)</div>
                    {% else %}
                    <div class="small text-info">(Association User)</div>
                    {% endif %}
                </div>
            </div>
        </nav>
    </div>

    <div id="layoutSidenav_content">
        <main>
            {% block content %}
            <main>
                <div class="container-fluid px-4">
                    <h2 class="mt-4">Dashboard</h2>
                    <ol class="breadcrumb mb-4">
                        <li class="breadcrumb-item active">Dashboard</li>
                    </ol>
                    <div class="row">
                        <div class="col-xl-3 col-md-6">
                            <div class="card bg-primary text-white mb-4">
                                <div class="card-body">MEMBERS</div>
                                <div class="card-footer d-flex align-items-center justify-content-between">
                                    <h4>{{ total_members }}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card bg-warning text-white mb-4">
                                <div class="card-body">UNIVERSITIES</div>
                                <div class="card-footer d-flex align-items-center justify-content-between">
                                    <h4>{{ total_universities }}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card bg-success text-white mb-4">
                                <div class="card-body">ASSOCIATIONS</div>
                                <div class="card-footer d-flex align-items-center justify-content-between">
                                    <h4>{{ total_associations }}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card bg-secondary text-white mb-4">
                                <div class="card-body">CONTRIBUTIONS</div>
                                <div class="card-footer d-flex align-items-center justify-content-between">
                                    <h4>{{ total_contributions }}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            {% endblock %}
        </main>
    </div>
</div>

<script src="{% static 'js/scripts.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.2/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.js"></script>

<script>
    new DataTable('#datatablesSimple');
</script>

</body>
</html>
