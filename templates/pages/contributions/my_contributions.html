{% extends 'pages/base.html' %}
{% load widget_tweaks %}
{% load dict_extras %}

{% block content %}
<div class="container mt-4">

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% else %}
        <div class="text-center mb-4">
            <img src="{{ association.logo.url }}" width="100" height="100" class="rounded-circle shadow-sm" alt="Logo">
            <h3 class="fw-bold mt-2">{{ association.name }} ({{ association.abbr }})</h3>
        </div>

        {% for c in contributions %}
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
                 data-bs-toggle="collapse"
                 data-bs-target="#collapse{{ forloop.counter }}"
                 style="cursor:pointer;">
                <span><i class="fa fa-calendar"></i> Year: {{ c.year }}</span>
                <i class="fa fa-chevron-down"></i>
            </div>

            <div id="collapse{{ forloop.counter }}" class="collapse">
                <div class="card-body">
                    <table class="table table-striped table-bordered">
                        <tr><th>Members</th><td>{{ c.association.member_number }}</td></tr>
                        <tr><th>Amount Paid</th><td>{{ c.amount_paid|floatformat:0 }}</td></tr>
                        <tr><th>Allocation</th><td>{{ c.allocation|floatformat:0 }}</td></tr>
                        <tr>
                            <th>Outstanding Balance</th>
                            <td style="color:{% if c.balance > 0 %}red{% else %}green{% endif %}">
                                {{ c.balance|floatformat:0 }}
                            </td>
                        </tr>
                        <tr><th>Date Records</th><td>{{ c.payment_date }}</td></tr>
                    </table>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="alert alert-info">No contributions found for your association.</div>
        {% endfor %}
    {% endif %}
</div>

<!-- Auto-hide alert messages -->
<script>
setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => alert.remove());
}, 4000);
</script>
{% endblock %}
